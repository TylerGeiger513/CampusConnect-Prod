
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tylergeiger513.github.io/CampusConnect-Prod/ci_cd/">
      
      
        <link rel="prev" href="../architecture/">
      
      
        <link rel="next" href="../local-deployment/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.10">
    
    
      
        <title>CI/CD - Campus Connect Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12.337%200c-.475%200-.861%201.016-.861%202.269%200%20.527.069%201.011.183%201.396a8.5%208.5%200%200%200-3.961%201.22%205.2%205.2%200%200%200-.595-1.093c-.606-.866-1.34-1.436-1.79-1.43a.4.4%200%200%200-.217.066c-.39.273-.123%201.326.596%202.353.267.381.559.705.84.948a8.7%208.7%200%200%200-1.528%201.716h1.734a7.18%207.18%200%200%201%205.381-2.421%207.18%207.18%200%200%201%205.382%202.42h1.733a8.7%208.7%200%200%200-1.32-1.53c.35-.249.735-.643%201.078-1.133.719-1.027.986-2.08.596-2.353a.4.4%200%200%200-.217-.065c-.45-.007-1.184.563-1.79%201.43a4.9%204.9%200%200%200-.676%201.325%208.5%208.5%200%200%200-3.899-1.42c.12-.39.193-.887.193-1.429%200-1.253-.386-2.269-.862-2.269M1.624%209.443v5.162h1.358v-1.968h1.64v1.968h1.357V9.443H4.62v1.838H2.98V9.443zm5.912%200v5.162h3.21v-1.108H8.893v-.95h1.64v-1.142h-1.64v-.84h1.853V9.443zm4.698%200v5.162h3.218v-1.362h-1.86v-3.8zm4.706%200v5.162h1.364v-2.643l1.357%201.225%201.35-1.232v2.65h1.365V9.443h-.614l-2.1%201.914-2.109-1.914zm-11.82%207.28a8.7%208.7%200%200%200%201.412%201.548%205.2%205.2%200%200%200-.841.948c-.719%201.027-.985%202.08-.596%202.353.39.273%201.289-.338%202.007-1.364a5.2%205.2%200%200%200%20.595-1.092%208.5%208.5%200%200%200%203.961%201.219%205%205%200%200%200-.183%201.396c0%201.253.386%202.269.861%202.269.476%200%20.862-1.016.862-2.269%200-.542-.072-1.04-.193-1.43a8.5%208.5%200%200%200%203.9-1.42c.121.4.352.865.675%201.327.719%201.026%201.617%201.637%202.007%201.364s.123-1.326-.596-2.353c-.343-.49-.727-.885-1.077-1.135a8.7%208.7%200%200%200%201.202-1.36h-1.771a7.17%207.17%200%200%201-5.227%202.252%207.17%207.17%200%200%201-5.226-2.252z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M6.602%2020.097H24v3.836H6.602zm-2.766-6.692h13.562v3.837H0V6.714h3.836zm13.562-9.502H0V.067h17.398zm2.766%206.692H6.602V6.758H24v10.528h-3.836z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cicd-deployment-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Campus Connect Docs" class="md-header__button md-logo" aria-label="Campus Connect Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Campus Connect Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CI/CD
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Campus Connect Docs" class="md-nav__button md-logo" aria-label="Campus Connect Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Campus Connect Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../local-deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Backend
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Backend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Databases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Databases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mongo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MongoDB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../friends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Friends
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../channels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Channels
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cicd-deployment-setup">CI/CD &amp; Deployment Setup</h1>
<h1 id="1-deployment-setup">1. Deployment Setup</h1>
<p>One of our biggest technical challenges was setting up a development workflow that worked both <strong>locally on Windows</strong> and for <strong>production-like deployments</strong> on CloudLab (Linux). Since Kubernetes behaves differently across platforms, we needed a system that could abstract those differences and streamline the process.</p>
<p>We decided to use <a href="https://minikube.sigs.k8s.io/docs/"><strong>Minikube</strong></a>, <a href="https://skaffold.dev/"><strong>Skaffold</strong></a>, and <a href="https://helm.sh/"><strong>Helm</strong></a>.</p>
<p>These tools allow us to:</p>
<ul>
<li>Develop and test services locally with real Kubernetes behavior.</li>
<li>Dynamically configure services depending on the environment (dev or prod).</li>
<li>Deploy with fast cached rebuilds.</li>
</ul>
<hr />
<details class="abstract">
<summary>Skaffold Integrations</summary>
<p>Skaffold manages the entire build-deploy process, automatically rebuilding and redeploying services when code changes. This significantly improves our development speed, especially with Node.js on a slow network connection where rebuilding and downloading <code>node_modules</code> can take ages.</p>
<div class="highlight"><span class="filename">skaffold.yaml</span><pre><span></span><code><span class="nt">build</span><span class="p">:</span>
<span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">campus-connect-backend</span>
<span class="w">    </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">    </span><span class="nt">docker</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile.backend.prod</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">campus-connect-frontend</span>
<span class="w">    </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<span class="w">    </span><span class="nt">docker</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile.frontend.prod</span>
</code></pre></div>
<p>Skaffold also supports <a href="https://skaffold.dev/docs/environment/profiles/"><strong>profiles</strong></a>, which allow us to use different configuration values and behaviors depending on whether we're developing locally or deploying to CloudLab.</p>
<div class="highlight"><span class="filename">skaffold.yaml</span><pre><span></span><code><span class="c1"># Development Profile (Local Machine)</span>
<span class="nt">profiles</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">helm</span><span class="p">:</span>
<span class="w">        </span><span class="nt">releases</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">campus-connect</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">chartPath</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./helm</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">valuesFiles</span><span class="p p-Indicator">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./helm/values.dev.yaml</span>
<span class="w">            </span><span class="nt">setValueTemplates</span><span class="p">:</span>
<span class="w">            </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="w">  </span><span class="c1"># Passed to Helm for templating</span>
<span class="c1"># Production Profile (Cloudlab)</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">helm</span><span class="p">:</span>
<span class="w">        </span><span class="nt">releases</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">campus-connect</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">chartPath</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./helm</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">valuesFiles</span><span class="p p-Indicator">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./helm/values.prod.yaml</span>
<span class="w">            </span><span class="nt">setValueTemplates</span><span class="p">:</span>
<span class="w">            </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{cmd</span><span class="nv"> </span><span class="s">&quot;hostname&quot;</span><span class="nv"> </span><span class="s">&quot;-f&quot;}}&#39;</span><span class="w">  </span><span class="c1"># Injects CloudLab hostname at runtime</span>
</code></pre></div>
<p>This setup allows us to toggle between environments simply by changing the Skaffold profile in the command line: </p>
<div class="highlight"><pre><span></span><code>skaffold<span class="w"> </span>run<span class="w"> </span>--p<span class="w"> </span>dev<span class="w"> </span>
skaffold<span class="w"> </span>run<span class="w"> </span>--p<span class="w"> </span>prod
</code></pre></div>
</details>
<details class="info">
<summary><strong>Helm</strong> <em>– Environment Templating</em></summary>
<p>Helm is used to manage our Kubernetes manifests. Instead of hardcoding values like the <code>domain</code> <em>(used in ingress, nginx, backend CORS settings, etc...)</em>, we inject them at deploy time using Helm and Skaffold.</p>
<p>In production, for example, we inject the domain dynamically to resolve to the cloudlab environments hostname using:</p>
<div class="highlight"><span class="filename">skaffold.yaml</span><pre><span></span><code><span class="nt">setValueTemplates</span><span class="p">:</span>
<span class="w">    </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{cmd</span><span class="nv"> </span><span class="s">&quot;hostname&quot;</span><span class="nv"> </span><span class="s">&quot;-f&quot;}}&#39;</span>
</code></pre></div>
<p>The <code>domain</code> value is then injected into multiple resources using Helm Templating:</p>
<div class="highlight"><span class="filename">ingress.yaml</span><pre><span></span><code><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<div class="highlight"><span class="filename">configmap.yaml</span><pre><span></span><code><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">DOMAIN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">CORS_ORIGIN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.domain</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<p>And finally used in our nginx config template, and backend CORS settings:</p>
<div class="highlight"><span class="filename">default.conf.template</span><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="nv">$DOMAIN</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</details>
<hr />
<h1 id="2-cicd-pipeline">2. CI/CD Pipeline</h1>
<p>Currently, our CI/CD setup is functional but partially manual. Code changes are pushed to GitHub, and a webhook triggers a sync with CloudLab. However, a user must still log into CloudLab and instantiate the deployment manually.</p>
<p>Our goal is to evolve this into a fully automated pipeline using GitHub Actions and the CloudLab PortalAPI.</p>
<hr />
<h2 id="a-continuous-integration-ci">A. Continuous Integration (CI)</h2>
<details class="note">
<summary>Current Webhook-Based Workflow</summary>
<p>The current workflow uses a GitHub webhook that sends a <code>POST</code> request to a CloudLab endpoint when code is pushed. That endpoint simply pulls the latest changes — <strong>but does not instantiate the deployment automatically</strong>.</p>
<pre class="mermaid"><code>flowchart LR
    A[Push to GitHub] --&gt; B[GitHub Webhook Fires]
    B --&gt; C[CloudLab Webhook Endpoint]
    C --&gt; D[CloudLab Repository Updates]
    D --&gt; E["Manual Profile Instantiation (User)"]
    E --&gt; F[Run Startup Scripts]</code></pre>
</details>
<details class="note">
<summary>Future CI Plans:</summary>
<p>We are planning to integrate GitHub Actions with the CloudLab PortalAPI. On push this would:</p>
<ul>
<li>Automatically instantiate the profile</li>
<li>SSH into the node</li>
<li>Tail deployment logs </li>
<li>Optionally run e2e tests after deploy (if we have time)</li>
</ul>
<pre class="mermaid"><code>flowchart LR
    A[Code Push to GitHub] --&gt; B[GitHub Action Triggered]
    B --&gt; C[Call CloudLab PortalAPI]
    C --&gt; D[Instantiate Profile]
    D --&gt; E[SSH into Node + Run Startup Script]
    E --&gt; F[Live Deployment Logs + Health Checks]
    F --&gt; G["Run Tests (optional)"]</code></pre>
</details>
<h2 id="b-continous-deployment-cd">B. Continous Deployment (CD)</h2>
<details>
<summary>1. Instantiation</summary>
<p>Once our project is instantiated, <code>profile.py</code> starts the deployment process with this line:</p>
<div class="highlight"><span class="filename">profile.py</span><pre><span></span><code><span class="n">node</span><span class="o">.</span><span class="n">addService</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span>
    <span class="n">shell</span><span class="o">=</span><span class="s2">&quot;sh&quot;</span><span class="p">,</span>
    <span class="n">command</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;sudo bash /local/repository/deploy_scripts/install_deps.sh &quot;</span>
        <span class="s2">&quot;&amp;&amp; sudo -u ccuser -i bash /local/repository/deploy_scripts/startup.sh&quot;</span>
    <span class="p">)</span>
<span class="p">))</span>
</code></pre></div>
<p>This does two things:</p>
<ol>
<li><strong>Runs <code>install_deps.sh</code> as root</strong> – installs Docker, Minikube, Skaffold, kubectl, and Helm.</li>
<li><strong>Runs <code>startup.sh</code> as a non-root user (<code>ccuser</code>)</strong> – starts Minikube, enables ingress, patches the controller, sets up port forwarding, and deploys via Skaffold.</li>
</ol>
<div class="admonition danger">
<p class="admonition-title">Security Concerns</p>
<ul>
<li>
<p><strong>Root access</strong> is used only where necessary (system-level package installs, permissions).</p>
</li>
<li>
<p>The rest of the app lifecycle runs under a <strong>limited, non-root user</strong> for security and isolation.</p>
</li>
</ul>
</div>
</details>
<details class="note">
<summary>2. install_deps.sh</summary>
<p>This script installs dependencies like Docker, Minikube, Skaffold, and Helm, and provisions the non-root deployment user: <code>ccuser</code></p>
<div class="highlight"><span class="filename">install_deps.sh</span><pre><span></span><code><span class="nv">USERNAME</span><span class="o">=</span>ccuser

<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>id<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$USERNAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>adduser<span class="w"> </span>--disabled-password<span class="w"> </span>--gecos<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="nv">$USERNAME</span>
<span class="w">  </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USERNAME</span>
<span class="w">  </span>usermod<span class="w"> </span>-aG<span class="w"> </span>sudo<span class="w"> </span><span class="nv">$USERNAME</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$USERNAME</span><span class="s2"> ALL=(ALL) NOPASSWD:ALL&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/sudoers.d/<span class="nv">$USERNAME</span>
<span class="w">  </span>chmod<span class="w"> </span><span class="m">0440</span><span class="w"> </span>/etc/sudoers.d/<span class="nv">$USERNAME</span>
<span class="k">fi</span>
</code></pre></div>
<ul>
<li><code>ccuser</code> is created </li>
<li>The user is added to the <strong><code>docker</code> group</strong> so it can run Docker containers.</li>
<li>All non-critical operations like starting Minikube, forwarding ports, and deploying with Skaffold are executed under this non-root user.</li>
<li>Logs are outputed to <code>/local/logs/install.log</code></li>
</ul>
</details>
<details class="note">
<summary>3. startup.sh</summary>
<p>This script is run as the non-root user <code>ccuser</code> and handles cluster initialization, ingress setup, port forwarding, and application deployment.</p>
<h3 id="1-start-minikube">1. Start Minikube</h3>
<div class="highlight"><pre><span></span><code>minikube<span class="w"> </span>start<span class="w"> </span>--driver<span class="o">=</span>docker
</code></pre></div>
<h3 id="2-enable-the-nginx-ingress-addon">2. Enable the NGINX Ingress Addon</h3>
<div class="highlight"><pre><span></span><code>minikube<span class="w"> </span>addons<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ingress
</code></pre></div>
<p>This installs the NGINX Ingress Controller, which acts as a <strong>reverse proxy</strong> that routes incoming HTTP(S) requests to the  Kubernetes frontend service. </p>
<h3 id="3-patch-the-ingress-controller-to-loadbalancer">3. Patch the Ingress Controller to <code>LoadBalancer</code></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>patch<span class="w"> </span>svc<span class="w"> </span>ingress-nginx-controller<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;: {&quot;type&quot;: &quot;LoadBalancer&quot;}}&#39;</span>
</code></pre></div>
<p>By default, Minikube deploys the ingress controller as a <code>ClusterIP</code> service, which means it’s only reachable from <strong>inside the cluster</strong>. This patch changes it to <code>LoadBalancer</code>, allowing traffic to be routed from <strong>outside</strong> the cluster.</p>
<h3 id="4-start-the-minikube-tunnel">4. Start the Minikube Tunnel</h3>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>-S<span class="w"> </span>nohup<span class="w"> </span>minikube<span class="w"> </span>tunnel<span class="w"> </span>&gt;<span class="w"> </span>/local/logs/tunnel.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>
<p>This command starts a tunnel background process that makes LoadBalancer services accessible from outside the cluster.</p>
<h3 id="5-use-socat-to-forward-port-80">5. Use socat to Forward Port 80</h3>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>-S<span class="w"> </span>nohup<span class="w"> </span>socat<span class="w"> </span>TCP-LISTEN:80,fork<span class="w"> </span>TCP:192.168.49.2:80<span class="w"> </span>&gt;<span class="w"> </span>/local/logs/socat.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>
<p>Even with the tunnel running, CloudLab doesn’t let us bind directly to port 80 on the public network interface. To get around this, we use socat, to listen on port 80 and forward incoming traffic to the internal <code>Minikube ingress IP</code>. This makes the app accessible from a browser using the node’s hostname, even though it’s running inside Minikube.</p>
<p>This makes the app reachable from:</p>
<div class="highlight"><pre><span></span><code>http://$(hostname -f)
</code></pre></div>
<h3 id="6-deploy-the-application-with-skaffold">6. Deploy the Application with Skaffold</h3>
<div class="highlight"><pre><span></span><code>skaffold<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span>prod
</code></pre></div>
<p>This command deploys the app using the production profile. The <code>prod</code> profile dynamically injects the correct domain as described above in <code>Skaffold</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">setValueTemplates</span><span class="p">:</span>
<span class="w">  </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{cmd</span><span class="nv"> </span><span class="s">&quot;hostname&quot;</span><span class="nv"> </span><span class="s">&quot;-f&quot;}}&#39;</span>
</code></pre></div>
<p>That hostname is then used by the ingress configuration, nginx templates, and backend CORS logic etc...</p>
<p>When the startup process is finished - the script prints:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;App should be accessible at: http://</span><span class="k">$(</span>hostname<span class="w"> </span>-f<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>